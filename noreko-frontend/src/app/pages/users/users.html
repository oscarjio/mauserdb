<div class="users-page">
  <h2>Användare</h2>
  <div *ngIf="loading">Laddar användare...</div>
  <div *ngIf="error" class="text-danger">{{ error }}</div>
  <table class="table table-striped" *ngIf="users.length">
    <thead>
      <tr>
        <th>Användarnamn</th>
        <th>Email</th>
        <th>Telefon</th>
        <th>Status</th>
        <th>Admin</th>
        <th>Senaste inloggning</th>
        <th>Åtgärder</th>
      </tr>
    </thead>
    <tbody>
      <ng-container *ngFor="let user of users">
        <tr [class.table-danger]="user.active === 0">
          <td>{{ user.username }}</td>
          <td>{{ user.email }}</td>
          <td>{{ user.phone || '-' }}</td>
          <td>
            <span class="badge" [class.bg-success]="user.active === 1" [class.bg-secondary]="user.active === 0">
              {{ user.active === 1 ? 'Aktiv' : 'Inaktiv' }}
            </span>
          </td>
          <td>
            <span class="badge" [class.bg-primary]="user.admin === 1" [class.bg-secondary]="user.admin === 0">
              {{ user.admin === 1 ? 'Admin' : 'Användare' }}
            </span>
          </td>
          <td>{{ user.last_login || '-' }}</td>
          <td>
            <div class="btn-group" role="group">
              <button class="btn btn-sm btn-outline-primary" (click)="toggleExpand(user.id)">
                {{ expanded[user.id] ? 'Stäng' : 'Redigera' }}
              </button>
              <button class="btn btn-sm btn-outline-info" (click)="toggleAdmin(user)" 
                      [title]="user.admin === 1 ? 'Ta bort admin-status' : 'Sätt som admin'">
                {{ user.admin === 1 ? '▼ Admin' : '▲ Admin' }}
              </button>
              <button class="btn btn-sm btn-outline-warning" (click)="toggleActive(user)"
                      [title]="user.active === 1 ? 'Inaktivera konto' : 'Aktivera konto'">
                {{ user.active === 1 ? 'Inaktivera' : 'Aktivera' }}
              </button>
              <button class="btn btn-sm btn-outline-danger" (click)="deleteUser(user)" title="Ta bort användare">
                Ta bort
              </button>
            </div>
          </td>
        </tr>
        <tr *ngIf="expanded[user.id]" class="edit-row">
          <td colspan="7">
            <form (ngSubmit)="saveUser(user)" class="edit-form">
              <div class="row g-2 align-items-center">
                <div class="col">
                  <input class="form-control" [(ngModel)]="user.username" name="username-{{user.id}}" placeholder="Användarnamn" required />
                </div>
                <div class="col">
                  <input class="form-control" [(ngModel)]="user.email" name="email-{{user.id}}" placeholder="Email" />
                </div>
                <div class="col">
                  <input class="form-control" [(ngModel)]="user.phone" name="phone-{{user.id}}" placeholder="Telefon" />
                </div>
                <div class="col">
                  <input class="form-control" [(ngModel)]="user.password" name="password-{{user.id}}" placeholder="Nytt lösenord" type="password" />
                </div>
                <div class="col">
                  <button class="btn btn-success" type="submit">Spara</button>
                </div>
              </div>
            </form>
          </td>
        </tr>
      </ng-container>
    </tbody>
  </table>
  <div *ngIf="!users.length && !loading">Inga användare hittades.</div>
</div> 