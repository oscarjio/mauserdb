<div class="container-fluid mt-4" *ngIf="loggedIn && isAdmin">
  <!-- Success Toast -->
  <div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1050;">
    <div class="toast show" *ngIf="showSuccessMessage" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="toast-header bg-success text-white">
        <i class="fas fa-check-circle me-2"></i>
        <strong class="me-auto">Framgång</strong>
        <button type="button" class="btn-close btn-close-white" (click)="showSuccessMessage = false"></button>
      </div>
      <div class="toast-body bg-dark text-white">
        {{ successMessage }}
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3 mb-0">
          <i class="fas fa-cogs me-2"></i>
          Rebotling Admin
        </h1>
        <div class="text-muted">
          <small>Inloggad som: <strong>{{ user?.username }}</strong></small>
        </div>
      </div>

      <!-- Product Management -->
      <div class="card mb-4">
        <div class="card-header bg-success text-white">
          <h5 class="card-title mb-0">
            <i class="fas fa-boxes me-2"></i>
            Produkthantering
          </h5>
        </div>
        <div class="card-body">
          <!-- Add New Product Form -->
          <div class="row mb-4">
            <div class="col-12">
              <div class="card border-primary">
                <div class="card-header bg-light">
                  <h6 class="mb-0">
                    <i class="fas fa-plus me-2"></i>
                    Lägg till ny produkt
                  </h6>
                </div>
                <div class="card-body">
                  <div class="row">
                    <div class="col-md-6">
                      <div class="mb-3">
                        <label for="newProductName" class="form-label">Produktnamn</label>
                        <input 
                          type="text" 
                          class="form-control" 
                          id="newProductName" 
                          [(ngModel)]="newProduct.name"
                          placeholder="Ange produktnamn">
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="mb-3">
                        <label for="newProductCycleTime" class="form-label">Cykeltid (minuter)</label>
                        <input 
                          type="number" 
                          class="form-control" 
                          id="newProductCycleTime" 
                          [(ngModel)]="newProduct.cycle_time_minutes"
                          min="1"
                          step="1"
                          placeholder="0">
                      </div>
                    </div>
                    <div class="col-md-2">
                      <div class="mb-3">
                        <label class="form-label">&nbsp;</label>
                        <button 
                          class="btn btn-primary w-100" 
                          (click)="addProduct()"
                          [disabled]="!newProduct.name || !newProduct.cycle_time_minutes">
                          <i class="fas fa-plus me-2"></i>
                          Lägg till
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Products Table -->
          <div class="table-responsive">
            <table class="table table-striped table-hover">
              <thead class="table-dark">
                <tr>
                  <th>ID</th>
                  <th>Produktnamn</th>
                  <th>Cykeltid (min)</th>
                  <th>Skapad</th>
                  <th>Åtgärder</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let product of products; trackBy: trackByProductId">
                  <td>{{ product.id }}</td>
                  <td>
                    <span *ngIf="!product.editing">{{ product.name }}</span>
                    <input 
                      *ngIf="product.editing" 
                      type="text" 
                      class="form-control form-control-sm" 
                      [(ngModel)]="product.name"
                      (keyup.enter)="saveProduct(product)"
                      (keyup.escape)="cancelEdit(product)">
                  </td>
                  <td>
                    <span *ngIf="!product.editing">{{ product.cycle_time_minutes }}</span>
                    <input 
                      *ngIf="product.editing" 
                      type="number" 
                      class="form-control form-control-sm" 
                      [(ngModel)]="product.cycle_time_minutes"
                      min="1"
                      step="1"
                      (keyup.enter)="saveProduct(product)"
                      (keyup.escape)="cancelEdit(product)">
                  </td>
                  <td>{{ product.created_at | date:'yyyy-MM-dd HH:mm' }}</td>
                  <td>
                    <div class="btn-group btn-group-sm" role="group">
                      <button 
                        *ngIf="!product.editing"
                        class="btn btn-outline-primary" 
                        (click)="editProduct(product)"
                        title="Redigera">
                        <i class="fas fa-edit"></i>
                      </button>
                      <button 
                        *ngIf="product.editing"
                        class="btn btn-outline-success" 
                        (click)="saveProduct(product)"
                        title="Spara">
                        <i class="fas fa-check"></i>
                      </button>
                      <button 
                        *ngIf="product.editing"
                        class="btn btn-outline-secondary" 
                        (click)="cancelEdit(product)"
                        title="Avbryt">
                        <i class="fas fa-times"></i>
                      </button>
                      <button 
                        class="btn btn-outline-danger" 
                        (click)="deleteProduct(product)"
                        title="Ta bort"
                        [disabled]="product.editing">
                        <i class="fas fa-trash"></i>
                      </button>
                    </div>
                  </td>
                </tr>
                <tr *ngIf="products.length === 0">
                  <td colspan="5" class="text-center text-muted">
                    <i class="fas fa-info-circle me-2"></i>
                    Inga produkter hittades. Lägg till en produkt ovan.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- System Status -->
      <div class="card">
        <div class="card-header bg-info text-white">
          <h5 class="card-title mb-0">
            <i class="fas fa-info-circle me-2"></i>
            Systemstatus
          </h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-3">
              <div class="text-center">
                <div class="h4 text-success">
                  <i class="fas fa-check-circle"></i>
                </div>
                <div class="small">System Online</div>
              </div>
            </div>
            <div class="col-md-3">
              <div class="text-center">
                <div class="h4 text-primary">
                  <i class="fas fa-database"></i>
                </div>
                <div class="small">Databas OK</div>
              </div>
            </div>
            <div class="col-md-3">
              <div class="text-center">
                <div class="h4 text-warning">
                  <i class="fas fa-clock"></i>
                </div>
                <div class="small">Senaste uppdatering</div>
                <div class="small">{{ currentTime | date:'HH:mm:ss' }}</div>
              </div>
            </div>
            <div class="col-md-3">
              <div class="text-center">
                <div class="h4 text-info">
                  <i class="fas fa-user-shield"></i>
                </div>
                <div class="small">Admin Åtkomst</div>
                <div class="small">Aktiverad</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Access Denied Message -->
<div class="container-fluid mt-4" *ngIf="!loggedIn || !isAdmin">
  <div class="row justify-content-center">
    <div class="col-md-6">
      <div class="card border-danger">
        <div class="card-header bg-danger text-white text-center">
          <h5 class="card-title mb-0">
            <i class="fas fa-lock me-2"></i>
            Åtkomst nekad
          </h5>
        </div>
        <div class="card-body text-center">
          <div class="mb-3">
            <i class="fas fa-exclamation-triangle text-danger" style="font-size: 3rem;"></i>
          </div>
          <p class="card-text">
            Du har inte behörighet att komma åt denna sida. 
            Endast administratörer kan komma åt rebotling admin-panelen.
          </p>
          <a href="/" class="btn btn-primary">
            <i class="fas fa-home me-2"></i>
            Gå tillbaka till startsidan
          </a>
        </div>
      </div>
    </div>
  </div>
</div>
