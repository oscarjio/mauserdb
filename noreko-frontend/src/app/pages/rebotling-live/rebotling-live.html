<div class="rebotling-live-page container-fluid">
  <div class="status-bar" [ngClass]="[statusBarClass, onRast ? 'status-bar-rast' : '']"></div>

  <!-- Rast-banner -->
  <div class="rast-banner" *ngIf="onRast">
    <i class="fas fa-coffee me-2"></i>
    <strong>PÅ RAST</strong>
    <span class="ms-3 rast-time-badge">{{ rastTimeLabel }} idag</span>
  </div>

  <div class="freshness-indicator" [class]="freshnessClass">
    <span class="freshness-dot"></span>
    <span class="freshness-text">{{ freshnessLabel }}</span>
  </div>
  <div class="row g-4 align-items-stretch justify-content-center" style="min-height: 250px;">
    <div class="col-4 d-flex align-items-stretch">
      <div class="live-card flex-fill clock-card h-100 w-100 d-flex flex-column justify-content-center align-items-center">
        <div class="live-label">Löpnummer</div>
        <div class="live-value live-rebotling-today">
          {{ nextLopnummer !== null && nextLopnummer !== 999 ? nextLopnummer : 'EJ OK' }}
        </div>
      </div>
    </div>
    <div class="col-4 d-flex align-items-stretch">
      <div class="live-card flex-fill h-100 w-100 d-flex flex-column justify-content-center align-items-center">
        <div class="live-label">Rebotlat idag</div>
        <div class="live-value live-rebotling-today">{{ ibcToday }}</div>
      </div>
    </div>
    <div class="col-4 d-flex align-items-stretch">
      <div class="live-card flex-fill h-100 w-100 d-flex flex-column justify-content-center align-items-center">
        <div class="live-label">Utetemperatur</div>
        <div class="live-value">
          {{ utetemperatur !== null ? (utetemperatur | number:'1.1-1') + '°C' : '--' }}
        </div>
      </div>
    </div>
    
    <div class="col-4 d-flex align-items-stretch">
      <div class="live-card flex-fill h-100 w-100 d-flex flex-column justify-content-center align-items-center">
        <div class="live-label">Denna timme</div>
        <div class="live-value live-rebotling-hour">{{ rebotlingThisHour }}</div>
      </div>
    </div>
    <div class="col-4 d-flex align-items-stretch">
      <div class="live-card flex-fill h-100 w-100 d-flex flex-column justify-content-center align-items-center">
        <div class="live-label">Per timme (mål)</div>
        <div class="live-value live-rebotling-hour-target">{{ hourlyTarget | number:'1.1-1' }}</div>
      </div>
    </div>
    <div class="col-4 d-flex align-items-stretch">
      <div class="live-card flex-fill speedometer-wrapper h-100 w-100 d-flex flex-column justify-content-center align-items-center">
        <div class="speedometer speedometer-modern w-100">
          <svg viewBox="0 0 300 180" width="100%" height="100%">
            <defs>
              <linearGradient id="speedoRed" x1="0" y1="0" x2="1" y2="0">
                <stop offset="0%" stop-color="#e74c3c"/>
                <stop offset="100%" stop-color="#e74c3c"/>
              </linearGradient>
              <linearGradient id="speedoYellow" x1="0" y1="0" x2="1" y2="0">
                <stop offset="0%" stop-color="#f1c40f"/>
                <stop offset="100%" stop-color="#f1c40f"/>
              </linearGradient>
              <linearGradient id="speedoGreen" x1="0" y1="0" x2="1" y2="0">
                <stop offset="0%" stop-color="#27ae60"/>
                <stop offset="100%" stop-color="#27ae60"/>
              </linearGradient>
            </defs>
            <!-- Red arc: 0-45 deg (25%) -->
            <path d="M60,160 A90,90 0 0,1 120,80" stroke="url(#speedoRed)" stroke-width="24" fill="none" stroke-linecap="round"/>
            <!-- Yellow arc: 45-90 deg (25%) -->
            <path d="M120,80 A90,90 0 0,1 180,80" stroke="url(#speedoYellow)" stroke-width="24" fill="none" stroke-linecap="round"/>
            <!-- Green arc: 90-180 deg (50%) -->
            <path d="M180,80 A90,90 0 0,1 240,160" stroke="url(#speedoGreen)" stroke-width="24" fill="none" stroke-linecap="round"/>
            <!-- Modern needle -->
            <g>
              <rect x="147" y="80" width="6" height="90" rx="3" fill="#fff" filter="url(#needleShadow)" [attr.transform]="'rotate(' + needleRotation + ' 150 150)'"/>
              <circle cx="150" cy="150" r="14" fill="#222" stroke="#fff" stroke-width="4"/>
              <circle cx="150" cy="150" r="7" fill="#fff"/>
            </g>
            <filter id="needleShadow" x="-50%" y="-50%" width="200%" height="200%">
              <feDropShadow dx="0" dy="4" stdDeviation="2" flood-color="#000" flood-opacity="0.4"/>
            </filter>
          </svg>
          <div class="speedometer-status mt-3 w-100 d-flex justify-content-center">
            <span class="badge" [class]="statusBadgeClass">{{ statusText }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
